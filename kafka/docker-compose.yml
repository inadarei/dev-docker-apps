# source that was modified: https://github.com/wurstmeister/kafka-docker 
version: '3'
services:
  zookeeper:
    image: wurstmeister/zookeeper
    ports:
      - "2181:2181"

  # @see: https://github.com/StreamingMicroservicesPlatform/docker-kafka    
  kafka-broker:
    image: solsson/kafka
    ports:
      - '9092:9092'
    volumes:
      - kafka_solsson:/tmp/kafka-logs
    entrypoint: ./bin/kafka-server-start.sh
    command:
      - config/server.properties
      - --override
      -   zookeeper.connect=zookeeper:2181
      #- --override 
      #    log.dirs=/var/lib/kafka/data/topics
      #- --override 
      #    log.retention.hours=-1
      - --override
      -   broker.id=0
      # unlike Kubernetes StatefulSet, compose gives containers a random hostname (leading to redirects to a hex name)
      - --override
      -   advertised.listener=PLAINTEXT://kafka-0:9092       



  schema-registry:
    image: confluentinc/cp-schema-registry:5.0.0-beta30
    hostname: schema-registry
    container_name: schema-registry
    depends_on:
      - zookeeper
      - kafka-broker
    ports:
      - "8081:8081"
    environment:
      SCHEMA_REGISTRY_HOST_NAME: schema-registry
      SCHEMA_REGISTRY_KAFKASTORE_CONNECTION_URL: 'zookeeper:2181'      
  
  kafdrop:
    image: thomsch98/kafdrop:latest
    ports:
    - "9010:9010" 
    environment:
    - "ZK_HOSTS=zookeeper:2181"
    - "LISTEN=9010"

  kafka-manager:
    image: sheepkiller/kafka-manager
    ports: 
      - "49092:9000"
    environment:
      APPLICATION_SECRET: letmein
      ZK_HOSTS: zookeeper:2181
      #KM_CONFIGFILE: /var/lib/kafka-manager/kafka-manager.conf

volumes:
  kafka_solsson:
  

